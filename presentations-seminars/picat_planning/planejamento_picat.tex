\section{Planejamento}


%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Planejamento}
\begin{minipage}{0.47\textwidth}
    \begin{itemize}
        \item O que é Planejamento?
        \item Importância da área
        \item Muitas definições
        \item Exemplo
    \end{itemize}
\end{minipage}
\begin{minipage}{0.5\textwidth}
\begin{figure}[ht!]
\begin{center}
\includegraphics[width=1.2\textwidth, height=0.40\textheight]{figures/logo_picat_alex.jpg}
\end{center}
\end{figure}
\end{minipage}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}[fragile]
%[fragile, allowframebreaks=0.9]

 \frametitle{Planejamento}

   \begin{block}{}
     \begin{itemize}
      \item Requisitos: recursividade, listas e PD
       \pause
      
      \item Além destes: conceitos grafos, árvores de busca, nós, etc
       
       \pause
      \item \textit{Planejamento} é um \textcolor{magenta}{\textbf{termo amplo e em vários domínios}} 
      
       \pause
      \item \textcolor{red}{O que \textbf{não} é o nosso contexto de \textit{planejamento}?}\\
      Exemplo: planejamento estratégico das empresas, planejar como distribuir
      os dividendos da empresa, orçamento familiar,  etc
      
      \pause
       \item \textcolor{violet}{O que é o nosso contexto de \textit{planejamento}?}
       \pause
       Questões que envolvam um ambiente, um agente (um programa, um robô, etc), sensores,
      e ações que modifiquem estados.\\ Exemplo clássico:  robótica em geral
 
    \end{itemize}
    
    \end{block}
    
\end{frame}



\begin{frame}[fragile]
%[fragile, allowframebreaks=0.9]

    \frametitle{Planejamento}

   \begin{block}{}
     \begin{itemize}
 
       
      \item Problemas em geral necessitam de um \textcolor{magenta}{\textbf{plano}} 
      para serem solucionados, assim,
      há uma visão que encontrar um plano para um problema $\Rightarrow$ ter uma solução!

      \pause
      \item Em resumo, a área de planejamento é bem complexa, 
       antiga na área da IA e robótica (1970 -- STRIPS), 
       efervescente, e de muito interesse na indústria.
           
      \pause
      \item Várias abordagens sobre a visão clássica da IA. Mas temos evoluções
      significativas ...
      
      \pause
      \item PDDL (\textit{Planning Domain Definition Language}): unanimidade (ou próxima a esta)
      entre os pesquisadores de planejamento, como linguagem descritora
      de problemas de planejamento.

      \pause
      \item Vários problemas ainda sem solução, pois a complexidade é exponencial 
      
      
     %  \pause
      
%     \item 

    \end{itemize}
    
    \end{block}
    
\end{frame}

%%%%%%%%%%%%%%%%%%% Exemplos

\begin{frame}[fragile]
	%[fragile, allowframebreaks=0.9]
	
	\frametitle{Exemplos Motivacionais}

\begin{figure}[!htb]
	\centering
	\includegraphics[width=.7\textwidth, height=0.640\textheight]{figures/classical_planning.pdf}
	%%%prolog/scale=0.47
	%\label{fig_nos_estados}
	\caption{Braço do Robo}
\end{figure}

\end{frame}


\begin{frame}[fragile]
	%[fragile, allowframebreaks=0.9]
	
	\frametitle{Exemplos Motivacionais}
	
	\begin{figure}[!htb]
		\centering
		\includegraphics[width=.7\textwidth, height=0.640\textheight]{figures/sheperd.pdf}
		%%%prolog/scale=0.47
		%\label{fig_nos_estados}
		\caption{Pastor, lobo, ovelha e o repolho}
	\end{figure}
	
\end{frame}



\begin{frame}[fragile]
	%[fragile, allowframebreaks=0.9]
	
	\frametitle{Exemplos Motivacionais}
	
	\begin{figure}[!htb]
		\centering
		\includegraphics[width=.7\textwidth, height=0.640\textheight]{figures/search-tree-sheper.pdf}
		%%%prolog/scale=0.47
		%\label{fig_nos_estados}
		\caption{\textit{Possibilidades} ou \'arvore de busca}
	\end{figure}
	
\end{frame}


\begin{frame}[fragile]
%[fragile, allowframebreaks=0.9]

  \frametitle{Definições}

   \begin{block}{}
     \begin{itemize}
      \item Plano: seqüência ordenada de ações
       \pause
         \begin{itemize}
           \item problema: escalar o Everest, comprar um abacate, leite e uma furadeira (nesta ordem)

           \pause
            \item plano: ir ao supermercado, ir à seção de frutas, pegar as bananas, 
            ir à seção de leite, pegar uma caixa de leite, ir ao caixa,  pagar tudo, 
            ir a uma loja de ferramentas, ..., voltar para casa.
                                
         \end{itemize}

       \pause
       \item Um Planejador:
        Combina conhecimento de um ambiente, um agente e suas ações possíveis,
        entradas (luz, cor, cheiro, sensor, etc), um estado corrente
        e/ou inicial, e com isto resolve de problemas planejar sequência
        de ações, que mudam de estados a cada ação, até atingir um 
        estado final.
       
    \end{itemize}
    
    \end{block}
    
\end{frame}



\begin{frame}[fragile]
\frametitle{Exemplos do que é planejamento ...}

\begin{figure}[!htb]
\centering
\includegraphics[width=0.85\textwidth, height=0.70\textheight]{figures/planning01.jpg}
%%%prolog/scale=0.47
%\label{fig_nos_estados}
\caption{\textit{A fome no meio da noite!}}
\end{figure}

%\framebreak

\end{frame}


\begin{frame}[fragile]
\frametitle{Exemplos do que é planejamento ...}

\begin{figure}[!htb]
\centering
\includegraphics[width=0.850\textwidth, height=0.650\textheight]{figures/mundo_dos_blocos01.jpg}
%%%prolog/scale=0.47
%\label{fig_nos_estados}
\caption{O \textit{mundo dos blocos}}
\end{figure}

%\framebreak

\end{frame}


\begin{frame}[fragile]
\frametitle{Espaço de Estados}

\begin{figure}[!htb]
\centering
\includegraphics[width=0.7\textwidth, height=0.70\textheight]{figures/mundo_dos_blocos02.jpg}
%%%prolog/scale=0.47
%\label{fig_nos_estados}
\caption{O espaço de estados do \textit{mundo dos blocos} $\times$ ações}
\end{figure}

%\framebreak

\end{frame}



\begin{frame}[fragile, allowframebreaks=0.9]
\frametitle{Elementos de um  Planejador -- Vocabulário}

%%%%\textcolor{red}{PAREI AQUI}

\begin{itemize}
 \item \underline{Plano}: uma sequência ordenada de ações, 
 criada incrementalmente a partir do estado inicial\\
Ex. posições das peças de um jogo\\
$$S_1 < S_2 < ... < S_n$$
 
  \item \underline{Ambiente}: onde um programa--agente vai receber entradas em um determinado
  estado e atuar com uma ação apropriada

  \item  \underline{Estados}:   descrição completa de possíveis estados atingíveis\\
  Problema: quanto aos estados não-previstos, inacessíveis?

  \item  \underline{Estado inicial}: um estado particular onde nosso programa--agente
  inicia a sua busca
  
  \item \underline{Objetivos}: estados desejados que o programa--agente precisa alcançar,
  isto é, um dos \textit{estados finais} desejados

  \item  \underline{Percepções}: cheiro, brisa, luz, choque,
  som, posições ou coordenadas, vizinhanças, etc

  \item \underline{Ações}: provocam modificações entre os estados corrente e sucessor\\
  Exemplos: avançar para próxima célula, girar 90 graus à direita ou à esquerda
pegar um objeto, atirar na direção do alvo, etc
 
 \item \underline{Operadores}: vocabulário ou repertório de atuações atômicas do que o agente pode fazer.\\
 Exemplos: $pegar(X)$, $mover\_de(X,Y)$, $levantar(X)$, $livre(X)$, etc
 
 \item Uma eventual confusão: \textcolor{magenta}{\textbf{uma ação é um conjunto de um ou mais operadores}},
 e ainda, \textcolor{magenta}{\textbf{a ação é condicional}}. 
 A ação só é disparada se as condições de pré-requisitos forem 
 satisfeitas.
 
 \item \underline{Heurística}: alguma função que  indica o progresso sobre os estados
 não visitados e sua convergência para uma finalização do plano
 
 
\end{itemize}

\end{frame}



\begin{frame}[fragile, allowframebreaks=0.9]
  \frametitle{O Problema Exemplo}

\begin{figure}[!htb]
\centering
\includegraphics[width=.3\textwidth, height=0.40\textheight]{figures/puzzle_2x3_01.jpg}
%%%prolog/scale=0.47
%\label{fig_nos_estados}
\caption{Um quebra-cabeça ($2\times 3$ ou $3\times 2$) \textit{simplificado} do conhecido $3\times 3$}
\end{figure}


\framebreak
\begin{figure}[!htb]
\centering
\includegraphics[width=.75\textwidth, height=0.65\textheight]{figures/puzzle_2x3_02.jpg}
%%%prolog/scale=0.47
%\label{fig_nos_estados}
\caption{Sim, \textit{simplificado} mas não muito!}
\end{figure}

\end{frame}

\begin{frame}[fragile, allowframebreaks=0.9]
 \frametitle{Partes do  código comentado}


\begin{footnotesize}
\begin{verbatim}
/*
A  B  C 
D  E  F
*/

%%%%%%%%%
%   1 5 %
% 4 3 2 %
%%%%%%%%%

import datetime.
import planner.
\end{verbatim}
\end{footnotesize}

\begin{center}
\textbf{\textcolor{red}{Atenção quanto a modelagem do problema, as 3 primeiras posicões da lista
correspondem a linha superior (A .. C), e as 3 últimas, a linha inferior (D .. F).}
}
\end{center}

\framebreak

\begin{footnotesize}
\begin{verbatim}
index(-)
estado_inicial( [0,1,5,4,3,2]  ).
%%%%%%%%%%%%%==> A,B,C,D,E,F

%% funcao final do planner
final( [1,2,3,4,5,0] ) => true .
%%%%==> A,B,C,D,E,F
%% pode ter uma condicional de parada

\end{verbatim}

\end{footnotesize}
\framebreak

\begin{footnotesize}
\begin{verbatim}
% Up <-> Down
/* Descrevendo as possiveis acoes para o planner */
action([A,B,C, D,E,F], S1, Acao, Custo_Acao ) ?=>
    Custo_Acao = 1,
    ( A == 0 ),  %% conj. condicoes
    S1 = [D,B,C, 0,E,F], 
    Acao = ($up(D),S1). %%a acao + estado modificado

action([A,B,C, D,E,F], S1, Acao, Custo_Acao ) ?=>
    Custo_Acao = 1,
    (A == 0 ),  %% conj. condicoes
    S1 = [0,B,C, A,E,F],
    Acao = ($dow(A),S1). %%a acao + estado modificado
.........................................................
\end{verbatim}
\end{footnotesize}

\framebreak


\begin{footnotesize}
\begin{verbatim}
% Left <-> Right
action([A,B,C, D,E,F], S1, Acao, Custo_Acao ) ?=>
    Custo_Acao = 1,
    (A == 0),  %% conj. condicoes
    S1 = [B,0,C, D,E,F],
    Acao = ($left(B), S1). %%a acao + estado modificado
    
action([A,B,C, D,E,F], S1, Acao, Custo_Acao ) ?=>
    Custo_Acao = 1,
    (B == 0),  %% conj. condicoes
    S1 = [0,A,C, D,E,F],
    Acao = ($right(A), S1). %%a acao + estado modificado
.........................................................
\end{verbatim}

\end{footnotesize}
\framebreak

\begin{footnotesize}
\begin{verbatim}
main  ?=>  
    estado_inicial( Q ),
    best_plan_unbounded( Q , Sol_Acoes), 
    println(sol = Sol_Acoes),
        
    printf("\n Estado Inicial: "),
    w_Quadro( Q ), 
    w_L_Estado( Sol_Acoes ), 
    Total := length(Sol_Acoes) ,
    Num_Movts := (Total -1) ,
    printf("\n Inicial  (estado): %w ", Q),
    printf("\n Total de acoes: %d", Total), 
    printf(" \n =========================================\n ")
    %%% fail ou false: descomente para multiplas solucoes
    .
 main => printf("\n Para uma solução .... !!!!" ) .
\end{verbatim}

\end{footnotesize}

\end{frame}



\begin{frame}[fragile]
 \frametitle{O código}

\begin{itemize}
  \item Acompanhar as explicações do código de:\\
\url{https://github.com/claudiosa/CCS/blob/master/picat/puzzle_2x3_planner.pi}

  \item Confira a execuç\~ao
\end{itemize}
\end{frame}


\begin{frame}[fragile, allowframebreaks=0.9]
 \frametitle{Parte da Saída}

\begin{footnotesize}
\begin{verbatim}
[ccs@gerzat picat]$ picat puzzle_2x3_planner.pi 
sol = [(left(1),[1,0,5,4,3,2]),(left(5),[1,5,0,4,3,2]),
(up(2),[1,5,2,4,3,0]),(right(3),[1,5,2,4,0,3]),(dow(5),[1,0,2,4,5,3]),
(left(2),[1,2,0,4,5,3]),(up(3),[1,2,3,4,5,0])]

 Estado Inicial: 
 0 1 5
 4 3 2

Acao: left(1)
 1 0 5
 4 3 2

Acao: left(5)
 1 5 0
 4 3 2
\end{verbatim}
\end{footnotesize}

\framebreak
\begin{footnotesize}
\begin{verbatim}
.................................
Acao: left(2)
 1 2 0
 4 5 3

Acao: up(3)
 1 2 3
 4 5 0

 Inicial  (estado): [0,1,5,4,3,2] 
 Total de acoes: 7 
 =========================================
\end{verbatim}
\end{footnotesize}

\end{frame}



\begin{frame}[fragile]
 \frametitle{O módulo do \textit{planner} do Picat}

\begin{itemize}
  \item O que efetivamente voce precisa saber
  
  \pause
  \item Importar um módulo \\
   \textbf{\texttt{import planner.}}

   \pause
   \item O predicado: \textit{final}\\
    \textbf{\texttt{final(S,Plan,Cost) => Plan=[], Cost=0, final(S).}}
   
    \pause
    \item O predicado \textit{action}\\
    \textbf{\texttt{action(S,NextS,Action,ActionCost)}}

\end{itemize}
\end{frame}


\begin{frame}[fragile]
 \frametitle{O módulo do \textit{planner} do Picat}

\begin{itemize}

 \item A \textcolor{magenta}{\textbf{eficiência}} do planner do Picat se dá devido a sua combinação
       de técnicas: \textcolor{magenta}{busca em profundidade} (e variações) e \textcolor{magenta}{Programação
       Dinâmica (PD)} (uso do \textit{tabling})


  \pause 
  \item O núcleo de busca dos planejadores  disponíveis no Picat são de 2 tipos:
  \begin{enumerate}
    \item Usam um busca em profundidade com limites (\textit{Depth-Bounded Search})
    \item Usam um busca em profundidade ilimitada de recursos (\textit{Depth-Unbounded Search}) 
  \end{enumerate}
  
  \item Contudo, estes 2 tipos apresentam muitas variações e opções:\\
  \pause
  Sem escapatória $\Rightarrow $ consultar o manual do Picat (\textit{User Guide to Picat})
  
  \item No exemplo aqui apresentado: 
  \texttt{best\_plan\_unbounded(S,Plan)}   
\end{itemize}
\end{frame}




\begin{frame}[fragile]
\frametitle{Reflexões}


\begin{itemize}
  \item Planejamento resolve uma classe ampla de problemas\\
   Havendo necessidade de
    \textcolor{magenta}{\textbf{descobrir sequências ações}} $\Leftrightarrow$ \textcolor{violet}{Planejamento}

  \pause
  \item Em geral, estes problemas são importantes na indústria

  \pause
  \item Os modelos escritos em PDDL (\textit{Planning Domain Definition Language})
  facilmente portáveis para Picat
    \pause
  \item Sob um uso mais restrito, um modelo em PDDL é executado diretamente em Picat
    
  \pause
  \item Na próxima seção uma outra técnica de resolver problemas: \textbf{\underline{PR}}
\end{itemize}

\end{frame}
